# High-Priority Outstanding Tasks

This list focuses on the next architectural shifts we agreed to make to reduce reliance on Unlock backends.

## 1) Move event check-in off Unlock (store in our DB)
Current state:
- Check-in status is read from Unlock Locksmith via `/v2/api/ticket/{chainId}/{lockAddress}/{tokenId}`.
- QR codes are fetched from Locksmith and emailed via the sponsor wallet.

Goal:
- Treat our database as the source of truth for attendance/check-in status.

High-level tasks:
- Create a DynamoDB table for check-ins (lockAddress + tokenId/userId as keys; include checkedInAt, checkedInBy, method, notes).
- Add a server-side check-in endpoint that verifies the attendee’s token ownership and records the check-in.
- Update the event details page to read attendance from our DB instead of Locksmith.
- Decide on QR format: either a signed payload generated by our app or a short-lived token stored in DB.
- Update the admin check-in UI (or build a staff-only check-in page) to use our endpoint.
- Decide whether we continue to fetch Locksmith QR codes during a transition period or fully replace them.

## 2) Move membership lock metadata off Unlock
Current state:
- Membership lock metadata (display names, descriptions, images) still relies on Unlock/Locksmith.

Goal:
- Store and serve membership tier metadata from our own DB, similar to event metadata.

High-level tasks:
- Define a membership metadata table (tier/lock address -> name, description, image, tier ordering).
- Add admin UI to edit membership metadata.
- Update membership views to use DB metadata (with on-chain name as fallback).
- Decide whether to update membership tokenURI to point to our metadata endpoint (similar to Option C for events).
- Document the migration plan (manual entry vs script backfill for existing tiers).

## Runbook: Deploy a New Event Lock (current workflow)
Use Unlock for the on-chain lock deployment, and then wire it into our app.

Steps:
1) Create the lock in Unlock (Base). Use a free price (token address = zero, key price = 0) for sponsored RSVPs.
2) Add the event sponsor wallet as a Lock Manager (required for sponsored RSVP + check-in).
3) Ensure on-chain discovery: the lock should either share the primary deployer or include the primary lock owner as a lock manager.
4) Set the lock’s base tokenURI to our metadata endpoint:\n   `EVENT_METADATA_BASE_URL=https://pgpforcrypto.org node scripts/setup/set-event-token-uri.mjs --lock <LOCK_ADDRESS>`
5) Add and publish the metadata in Admin → Events.
6) Verify the event appears on the home page and `/events/<LOCK_ADDRESS>` loads.
7) Test RSVP (sponsored) and check-in QR (until we replace it with DB-based check-ins).
